{"version":3,"sources":["app.coffee"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["(($) ->\n\n    # Custom single/double click listener\n    # Reference: http://stackoverflow.com/questions/6330431/jquery-bind-double-click-and-single-click-separately\n    $.fn.singleDoubleClick = (singleClickCallback, doubleClickCallback, timeout) ->\n        this.each ->\n            clicks = 0\n            self = this\n            $(this).click (event)->\n                clicks++;\n                if clicks is 1\n                    setTimeout ->\n                        if clicks is 1\n                            singleClickCallback.call(self, event)\n                        else\n                            doubleClickCallback.call(self, event)\n                        clicks = 0;\n                    , (timeout || 250)\n\n    init = ->\n        initAjaxCSRF()\n        initBreadcrumb()\n        initFileSelection()\n        initNewFolder()\n        initUpload()\n        initRename()\n        initDeletion()\n        initTooltip()\n\n    initAjaxCSRF = ->\n        $.ajaxSetup\n            headers:\n                'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr(\"content\") # Set up CSRF Token for every AJAX request\n\n    initTooltip = ->\n        $('[data-toggle=\"tooltip\"]').tooltip()\n\n    initNewFolder = ->\n        $(\"#new_folder\").on \"click\", ->\n            $(this).prop(\"disabled\", true)\n            insertObject(\"directory\", true)\n            names = []\n\n            $(\".object\").each ->\n                basename = $(this).data(\"basename\")\n\n                if basename.indexOf(\"Untitled Folder\") > -1\n                    basename = basename.replace(\"Untitled Folder\", \"\").trim()\n                    if not basename\n                        basename = 1\n                    names.push(parseInt(basename,10))\n\n            if names.length > 0\n                newFolder = \"Untitled Folder #{Math.max.apply(Math, names) + 1}\"\n            else\n                newFolder = \"Untitled Folder\"\n\n            $(\"#input-folder\").val(\"#{newFolder}\").focus().select() # Increment and populate the new Untitled Folder\n\n        $(\"#file_system\").on \"focusout\", \".object .name #input-folder\", ->\n            $(this).parent().trigger(\"submit\")\n            return false\n\n        $(\"#file_system\").on \"submit\", \"#create-form\", (e) ->\n            e.preventDefault()\n\n            if not $(\"#input-folder\").val()\n                $(this).parents(\"object-container\").remove()\n                $(\"#new_folder\").prop(\"disabled\", false)\n                return false\n\n            currentObject = $(this).parents(\".object\")\n            currentObject.first().addClass(\"uploading\") # Add uploading animation\n\n            $.ajax\n                url: \"/manager/put/directory\",\n                data:\n                    path: $(\"#file_system\").data(\"dirpath\")\n                    dirName: $(\"#input-folder\").val()\n                type: \"PUT\"\n                dataType: \"json\"\n            .success (response) ->\n                # Remove form and populate meta data\n                populateMeta(currentObject, \"directory\", response)\n                initFileSelection(currentObject)\n            .fail (response) ->\n                # Show error message\n                alert(\"Failed to create the folder\")\n                $(this).parents(\".object\").removeClass(\"uploading\")\n                .find(\"input-folder\").focus().select()\n            .done (response) ->\n                $(\"#new_folder\").prop(\"disabled\", false)\n\n    initBreadcrumb = ->\n        fullPath = $(\"#file_system\").data(\"dirpath\")\n\n        if fullPath is '/'\n            return false\n\n        currentLink = \"/home\"\n        $.each fullPath.split('/'), (index, node) ->\n            currentLink += \"/#{node}\"\n            $(\".breadcrumb\").append(\"\"\"<li class=\"breadcrumb-item\"><a href=\"#{currentLink}\">#{node}</a></li>\"\"\")\n\n    initUpload = ->\n        $(\"#fileupload\").on \"change\", ->\n            files = this.files\n            maxFileSize = $(\"#file_system\").data(\"maxfilesize\") - 512 # Consider POST overhead\n\n            $.each files, (index, file) ->\n                if file.size > maxFileSize\n                    alert \"File #{file.name} is too large\"\n                    return false\n\n            formData = new FormData($(\"#upload\")[0])\n\n            $.ajax\n                url: \"/manager/put/file\",\n                type: \"POST\"\n                dataType: \"json\"\n                data: formData\n                cache: false\n                contentType: false # Prevent jQuery from processing the data\n                processData: false\n            .success (responses) ->\n                $(responses.errors).each (index, error) ->\n                    console.log error\n                $(responses.success).each (index, file) ->\n                    newObject = $(insertObject(\"file\", false)).children()\n                    populateMeta(newObject, \"file\", file)\n                    initFileSelection(newObject)\n            .fail ->\n                alert(\"Upload failed\")\n\n    insertObject = (objectType, newObject) ->\n        nameInput = \"\"\"\n            <form id=\"create-form\">\n                <label for=\"input-folder\" class=\"sr-only\">New folder</label>\n                <input type=\"text\" placeholder=\"Folder Name\" id=\"input-folder\" class=\"text-center\">\n                <input type=\"hidden\" name=\"_method\" value=\"PUT\">\n            </form>\n            \"\"\"\n\n        if newObject\n            name = nameInput\n        else\n            name = null\n\n        objectModel = \"\"\"\n             <div class=\"col-xs-4 col-sm-3 col-md-2 object-container\">\n                 <div data-basename=\"\" data-mime=\"\" data-filetype=\"\" class=\"object object-new\">\n                     <div class=\"icon-container\">\n                         <div class=\"icon-base #{objectType}\"></div>\n                         <div class=\"icon-main\"></div>\n                     </div>\n                     <div class=\"name-container\">\n                         <div title=\"\" class=\"name text-primary\" role=\"button\">\n                            #{name}\n                         </div>\n                         <div class=\"meta-info text-muted\"></div>\n                     </div>\n                 </div>\n             </div>\n             \"\"\"\n\n        if objectType is \"directory\"\n            return $(objectModel).prependTo( \"#file_system\" )\n        else if objectType is \"file\"\n            return $(objectModel).hide().appendTo( \"#file_system\" ).fadeIn(500)\n\n    populateMeta = (object, objectType, objectMeta) ->\n        if not objectMeta.pathinfo.dirname\n            link = \"/home#{objectMeta.path}\"\n        else\n            link = \"/home/#{objectMeta.path}\"\n\n        object.removeClass(\"uploading\").removeClass(\"renaming\").removeClass(\"object-new\") # Remove uploading animation\n        .data(\"filetype\", objectMeta.mime)\n        .data(\"basename\", objectMeta.pathinfo.basename)\n        .data(\"fullpath\", objectMeta.path)\n        .find(\".name\").empty() # Replace name class with new data\n        .append(\"\"\"<a class=\"link\" href=\"#{link}\">#{objectMeta.pathinfo.basename}</a> <a href=\"#\" class=\"hide rename\"><span class=\"glyphicon glyphicon-pencil\" aria-hidden=\"true\"></a>\"\"\")\n        .parent().children(\".meta-info\").empty() # Replace last modified time with \"Just now\"\n        .append(\"<div class=\\\"meta-info text-muted\\\">Just now</div>\")\n\n    initRename = () ->\n        $(\"#file_system\").on \"click\", \".object .rename\", (e) ->\n            e.preventDefault()\n            renameInput($(this).parents(\".object\"))\n            return false\n\n        $(\"#file_system\").on \"focusout\", \".object .name #input-file\", ->\n            $(this).parent().trigger(\"submit\")\n            return false\n\n        $(\"#file_system\").on \"submit\", \"#rename-form\", (e) ->\n            e.preventDefault()\n\n            currentObject = $(this).parents(\".object\")\n            oldName = currentObject.data(\"basename\")\n            newName = $(this).children(\"#input-file\").val()\n            fileType = currentObject.data(\"filetype\")\n\n            if not newName or (oldName is newName) # No name change\n                $(this).parent().find(\"a\").show()\n                $(this).remove()\n                return false\n\n            currentObject.addClass(\"renaming\") # Add renaming effects\n\n            $.ajax\n                url: \"/manager/move\",\n                data:\n                    path: $(\"#file_system\").data(\"dirpath\")\n                    oldName: oldName\n                    newName: newName\n                    fileType: fileType\n                type: \"POST\"\n                dataType: \"json\"\n            .success (response) ->\n                # Remove form and populate meta data\n                currentObject.find(\".name\").empty()\n                populateMeta(currentObject, fileType, response)\n            .fail ->\n                # Show error message\n                alert(\"Failed to rename the object\")\n                currentObject.removeClass(\"renaming\").find(\".name a\").show()\n                currentObject.find(\"#rename-form\").remove()\n            return false\n\n    renameInput = (object) ->\n        oldName = object.data(\"basename\");\n        nameInput = \"\"\"\n            <form id=\"rename-form\">\n                <label for=\"input-file\" class=\"sr-only\">File Name</label>\n                <input type=\"text\" placeholder=\"Folder Name\" id=\"input-file\" class=\"text-center\" value=\"#{oldName}\">\n            </form>\n            \"\"\"\n\n        object.find(\".name a\").hide()\n        $(nameInput).prependTo(object.find(\".name\")).find(\"#input-file\").focus().select()\n\n    initFileSelection = (object) ->\n        if not object\n            object = $(\"#file_system .object\")\n\n        object.singleDoubleClick(\n            (() ->\n                $(this).toggleClass(\"selected\")),\n            (() ->\n                if ($(this).data(\"filetype\") is \"directory\")\n                    $(\"#file_system\").addClass(\"loading\")\n                window.location = ($(this).find(\".link\").attr(\"href\"))))\n\n    initDeletion = () ->\n        $(\"#delete_object\").on \"click\", ->\n            selectedFiles = $(\".selected\")\n\n            if selectedFiles.length is 0\n                alert \"Please select object(s) first\"\n                return false\n\n            $(this).prop(\"disabled\", true)\n\n            selectedFiles.each (index, file) ->\n                fileType = $(file).data(\"filetype\")\n                $.ajax\n                    url: \"/manager/delete\",\n                    data:\n                        path: $(file).data(\"fullpath\")\n                        fileType: fileType\n                    type: \"DELETE\"\n                    dataType: \"json\"\n                .success ->\n                    # Remove form and populate meta data\n                    $(file).fadeOut 500, ->\n                        $(this).parent().remove()\n                .fail ->\n                    # Show error message\n                    alert(\"\"\"Failed to delete #{fileType} #{$(file).data(\"basename\")}\"\"\")\n                .done ->\n                    $(\"#delete_object\").prop(\"disabled\", false) # Enable delete button\n\n    return init()\n\n) jQuery\n"]}